---
type: claude-knowledge
source: aiprojects
source_path: ".claude/context/patterns/automation-routing.md"
source_category: "pattern"
synced: 2026-02-18
title: "Automation Routing Pattern"
tags:
  - claude-knowledge
  - pattern
---

# Automation Routing Pattern

**When user asks to "schedule", "automate", or "run on cron"**, apply this decision tree:

```
Is it deterministic (same input -> same output)?
|-- YES -> Use pure bash script (capability layering)
|          Location: Scripts/ or .claude/jobs/
|          Example: backups, file cleanup, git sync
|
+-- NO -> Does it require AI judgment?
          |-- YES -> Use Headless Claude system
          |          Registry: .claude/jobs/registry.yaml
          |          Dispatcher: .claude/jobs/dispatcher.sh (single cron, every 5 min)
          |          Example: upgrade discovery, health checks, troubleshooting
          |
          +-- MAYBE -> Hybrid approach
                       Bash for deterministic parts, Claude for analysis
                       Example: weekly-context-analysis.sh (Ollama for summarization)
```

## Headless Claude Quick Commands

```bash
# List all registered jobs
.claude/jobs/dispatcher.sh --list

# Check what's due now
.claude/jobs/dispatcher.sh --check

# Force-run a specific job
.claude/jobs/dispatcher.sh --run health-summary

# Preview execution (dry run)
.claude/jobs/executor.sh --job upgrade-discover --dry-run
```

## Personas (safety model for scheduled execution)

- **Investigator**: Read-only - health checks, monitoring, analysis
- **Analyst**: Read + write reports - upgrade discovery, data collection
- **Troubleshooter**: Diagnostics + safe fixes - service restarts, cache clearing

See `.claude/jobs/registry.yaml` for job definitions and Obsidian `05-AI/Projects/Headless-Claude/` for full design.
