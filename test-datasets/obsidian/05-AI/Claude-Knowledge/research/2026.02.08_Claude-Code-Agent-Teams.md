---
type: claude-knowledge
source: aiprojects
source_path: ".claude/agent-output/results/deep-research/2026-02-08_claude-code-agent-teams.md"
source_category: "deep-research"
synced: 2026-02-17
title: "Deep Research: Claude Code Agent Teams Feature"
tags:
  - claude-knowledge
  - deep-research
---

# Deep Research: Claude Code Agent Teams Feature

**Research Date**: 2026-02-08
**Confidence Level**: High
**Sources Consulted**: 12

## Executive Summary

Claude Code Agent Teams is a **research preview** feature introduced in **v2.1.32** (late January / early February 2026), with refinements in **v2.1.33**. It enables multi-session orchestration where multiple independent Claude Code instances collaborate on a shared project. One session acts as the **team lead** (coordinator), and it spawns **teammates** (independent Claude Code instances) that work in parallel, each with its own context window. Unlike subagents which run within a single session and report back, teammates can **message each other directly**, self-claim tasks from a shared task list, and operate fully independently.

The feature is gated behind the `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` environment variable. It is explicitly labeled experimental with known limitations around session resumption, task coordination latency, and shutdown behavior. Token costs scale linearly with team size -- a 5-member team uses approximately 5x the tokens of a single session.

The feature is distinct from Claude Code's existing subagent system. Subagents are lightweight workers that report results back to the parent. Agent Teams are full peer-to-peer collaborative sessions with shared task lists, direct inter-agent messaging, and a mailbox system for asynchronous communication.

## Key Findings

### 1. Architecture: Lead + Teammates + Shared Task List + Mailbox

The architecture has four components:

| Component | Role |
|-----------|------|
| **Team Lead** | The main Claude Code session that creates the team, spawns teammates, and coordinates work |
| **Teammates** | Separate Claude Code instances that each work on assigned tasks independently |
| **Task List** | Shared list of work items with states: pending, in_progress, completed. Supports dependency tracking |
| **Mailbox** | Messaging system for direct communication between agents |

**Storage locations:**
- Team config: `~/.claude/teams/{team-name}/config.json` (members array with name, agent ID, agent type)
- Task list: `~/.claude/tasks/{team-name}/`
- Messages: `~/.claude/teams/{team-name}/messages/`

Teammates load the same project context as a regular session (CLAUDE.md, MCP servers, skills) plus the spawn prompt from the lead. The lead's conversation history does NOT carry over.

### 2. How to Enable It

**Option A: Environment variable**
```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

**Option B: settings.json** (recommended for persistence)
```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

Settings file location: `~/.claude/settings.json`

No special CLI flag is required to "start" a team -- you simply ask Claude to create one in your prompt after enabling the env var.

### 3. CLI Flags and Configuration

| Setting | CLI Flag | settings.json key | Default |
|---------|----------|-------------------|---------|
| Display mode | `--teammate-mode <mode>` | `teammateMode` | `"auto"` |
| Delegate mode | Shift+Tab in session | N/A | Off |

**Display modes:**
- `"auto"` (default): Uses split panes if already inside tmux, otherwise in-process
- `"in-process"`: All teammates run inside the main terminal. Navigate with Shift+Up/Down
- `"tmux"`: Each teammate gets its own pane. Requires tmux or iTerm2 with `it2` CLI

There is **no `--agent-teams` CLI flag**. The feature is controlled entirely by the environment variable `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1`.

### 4. Core Tools (Internal)

When agent teams are enabled, Claude gains access to these tools:

**TeammateTool (TeamCreate)**
```json
{
  "operation": "spawnTeam",
  "team_name": "my-project",
  "description": "Working on feature X"
}
```
Operations: `spawnTeam`, `cleanup`

**SendMessage**
Message types:
- `message` - Direct message to one teammate
- `broadcast` - Send to all teammates (use sparingly, costs scale with team size)
- `shutdown_request` / `shutdown_response` - Graceful teardown
- `plan_approval_response` - Quality gate for plan-before-implement workflow

**TaskCreate**
```json
{
  "subject": "Implement auth module",
  "description": "Detailed instructions (essentially a prompt for the agent)",
  "activeForm": "Working on auth module..."
}
```

**TaskUpdate**
```json
{
  "taskId": "task-123",
  "status": "in_progress",
  "owner": "teammate-name",
  "addBlockedBy": ["task-456"]
}
```

**TaskList / TaskGet** - Query task status across the team.

Task claiming uses **file locking** to prevent race conditions when multiple teammates try to claim the same task.

### 5. Hook Events for Agent Teams

Added in v2.1.33:

| Hook | When It Fires | Action on Exit Code 2 |
|------|---------------|----------------------|
| `TeammateIdle` | Teammate is about to go idle | Sends feedback, keeps teammate working |
| `TaskCompleted` | Task is being marked complete | Prevents completion, sends feedback |

These hooks enable **quality gates** -- you can enforce that teammates meet certain criteria before marking work as done (e.g., tests pass, lint clean, documentation updated).

### 6. Delegate Mode

Prevents the lead from implementing tasks itself. The lead is restricted to coordination-only tools: spawning, messaging, shutting down teammates, and managing tasks. Toggle with **Shift+Tab** during a session.

### 7. Plan Approval Workflow

Teammates can be required to plan before implementing:
- Teammate works in **read-only plan mode**
- Submits plan to lead for approval
- Lead approves or rejects with feedback
- If rejected, teammate revises and resubmits
- Once approved, teammate exits plan mode and begins implementation

The lead makes approval decisions autonomously. Influence with prompt criteria like "only approve plans that include test coverage."

### 8. Headless / Scheduled Use

There is **no dedicated headless mode for agent teams specifically**. However:
- Claude Code already supports headless mode via `claude -p` (print mode)
- The environment variable `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` can be set before a headless invocation
- In-process teammate mode works without a terminal UI
- For CI/CD pipelines, you would set the env var and use `claude -p` with a prompt that requests a team

**Important caveat**: Agent teams are interactive by nature (selecting teammates, approving plans, monitoring progress). Full headless operation is possible but less controlled -- the lead makes all coordination decisions autonomously.

## Detailed Analysis

### How It Differs from Subagents

| Aspect | Subagents | Agent Teams |
|--------|-----------|-------------|
| Context | Own window, results return to caller | Own window, fully independent |
| Communication | Report to main agent only | Message each other directly |
| Coordination | Main agent manages all work | Shared task list with self-coordination |
| Best for | Focused tasks where only result matters | Complex work requiring discussion |
| Token cost | Lower (results summarized back) | Higher (each is separate instance) |
| Spawning | Automatic by Claude as needed | Explicit team creation |

### Task Dependency System

Tasks support dependency tracking via `addBlockedBy`. A pending task with unresolved dependencies cannot be claimed until those dependencies are completed. When a teammate completes a task that others depend on, blocked tasks unblock automatically.

### Permission Model

- Teammates inherit the lead's permission settings at spawn time
- If lead runs with `--dangerously-skip-permissions`, all teammates do too
- Individual teammate modes can be changed after spawning
- Per-teammate modes at spawn time are NOT supported
- Pre-approve common operations before spawning to reduce permission prompt friction

### Communication Flow

1. Messages from teammates arrive at the lead automatically (no polling)
2. Idle notifications are sent automatically when a teammate finishes
3. All agents can see task status and claim available work
4. Teammates go idle after every turn -- this is normal and expected
5. Idle teammates can receive messages and process them normally

## Best Practices

1. **Give teammates rich context in spawn prompts** -- they do NOT inherit the lead's conversation history. Include file paths, technology details, constraints.

2. **Size tasks appropriately** -- Too small: coordination overhead exceeds benefit. Too large: teammates work too long without check-ins. Target: self-contained units producing a clear deliverable (a function, a test file, a review).

3. **Aim for 5-6 tasks per teammate** -- keeps everyone productive and lets the lead reassign if someone gets stuck.

4. **Avoid file conflicts** -- Two teammates editing the same file = last write wins. Structure tasks so each teammate owns different files.

5. **Start with research/review** -- Before using teams for code generation, try parallel code reviews, library research, or bug investigation. Lower coordination risk.

6. **Pre-approve permissions** -- The most common friction point. Configure permission settings before spawning.

7. **Use delegate mode for complex orchestration** -- Prevents the lead from doing work instead of coordinating.

8. **Monitor and steer** -- Check in on progress. Redirect approaches that are not working. Do not let a team run unattended too long.

## Common Pitfalls

1. **Lead does work instead of delegating** -- The lead sometimes implements tasks itself. Use delegate mode (Shift+Tab) or explicitly tell it: "Wait for your teammates to complete their tasks before proceeding."

2. **Task status lag** -- Teammates sometimes fail to mark tasks as completed, blocking dependent tasks. Manually nudge the teammate or update status through the lead.

3. **Session resumption breaks teams** -- `/resume` and `/rewind` do NOT restore in-process teammates. After resuming, the lead may try to message non-existent teammates. Workaround: start fresh, spawn new teammates.

4. **Orphaned tmux sessions** -- If a tmux session persists after team cleanup, kill it manually: `tmux ls && tmux kill-session -t <name>`

5. **Token burn rate** -- A 5-member team burns ~5x tokens. Use teams only when parallelism provides genuine value.

6. **Nested teams impossible** -- Teammates cannot spawn their own teams. Only the lead can manage the team.

7. **Split panes require tmux/iTerm2** -- In-process mode works in any terminal. Split-pane mode is NOT supported in VS Code integrated terminal, Windows Terminal, or Ghostty.

## Conflicting Information

- Some community guides suggest agent teams work well for all types of parallel work. The official documentation is more measured, explicitly noting that for sequential tasks, same-file edits, or work with many dependencies, a single session or subagents are more effective.

- The term "swarm" is used in community blog posts but is not the official Anthropic terminology. The official term is "Agent Teams."

- Some sources suggest this feature was available before Opus 4.6. The changelog confirms it was introduced in v2.1.32, which coincided with the Opus 4.6 release.

## Knowledge Gaps

1. **Exact token overhead per teammate** -- No precise numbers published beyond "significantly more" and "~5x for 5 teammates."

2. **Headless team orchestration details** -- Whether `claude -p` with agent teams works reliably in fully unattended CI/CD pipelines is not well-documented. The feature is designed for interactive use.

3. **Maximum team size** -- No documented limit on number of teammates, though practical limits exist from token costs and coordination overhead.

4. **SDK integration** -- Whether the Claude Code SDK (`@anthropic-ai/claude-code`) exposes agent team primitives for programmatic control is not clearly documented.

5. **Cross-project teams** -- Whether teammates can work across different git repositories or are limited to a single project directory.

## Recommendations

### For Your AIProjects Setup

1. **Enable the feature** -- Add to `~/.claude/settings.json`:
   ```json
   {
     "env": {
       "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
     }
   }
   ```

2. **Start with parallel code review** -- Test with a non-destructive use case first. Ask for a 3-teammate review of a specific module from security, performance, and maintainability angles.

3. **Consider for infrastructure audits** -- Spawning teammates to investigate Docker, networking, and storage in parallel could be highly effective for your home lab.

4. **Update your autonomous execution pattern** -- Agent teams add a new capability tier. A scheduled Claude job could spawn a team for comprehensive system review, though the interactive nature of teams makes fully autonomous operation uncertain.

5. **CLAUDE.md is your friend** -- Teammates read CLAUDE.md automatically. Your existing project context files will provide good grounding for teammates.

6. **Pre-approve operations** -- Given your infrastructure context, pre-approve Docker read commands, filesystem reads, and git operations to minimize permission prompt friction.

7. **Do not use for session management** -- Given the session resumption limitation, do not rely on agent teams for work that must survive session boundaries. Use your existing Beads system for that.

## Sources

1. [Official Anthropic Documentation - Agent Teams](https://code.claude.com/docs/en/agent-teams) - **Credibility: High** - Primary source, comprehensive official docs
2. [Claude Code CHANGELOG.md on GitHub](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md) - **Credibility: High** - Version history confirming v2.1.32/v2.1.33 features
3. [Addy Osmani - Claude Code Swarms](https://addyosmani.com/blog/claude-code-agent-teams/) - **Credibility: High** - Google Chrome engineer, detailed technical analysis
4. [Paddo.dev - Claude Code's Hidden Multi-Agent System](https://paddo.dev/blog/claude-code-hidden-swarm/) - **Credibility: Medium** - Independent reverse engineering
5. [Kieran Klaassen - Swarm Orchestration Skill Gist](https://gist.github.com/kieranklaassen/4f2aba89594a4aea4ad64d753984b2ea) - **Credibility: Medium** - Community-compiled reference
6. [Piebald-AI - TeammateTool System Prompt](https://github.com/Piebald-AI/claude-code-system-prompts/blob/main/system-prompts/tool-description-teammatetool.md) - **Credibility: Medium** - Extracted system prompt documentation
7. [Marco Patzelt - Agent Teams Setup Guide](https://www.marc0.dev/en/blog/claude-code-agent-teams-multiple-ai-agents-working-in-parallel-setup-guide-1770317684454) - **Credibility: Medium** - Practical setup walkthrough
8. [VentureBeat - Claude Opus 4.6 Agent Teams](https://venturebeat.com/technology/anthropics-claude-opus-4-6-brings-1m-token-context-and-agent-teams-to-take) - **Credibility: High** - Major tech publication
9. [NxCode - Claude Agent Teams Tutorial](https://www.nxcode.io/resources/news/claude-agent-teams-parallel-ai-development-guide-2026) - **Credibility: Medium** - Tutorial with practical examples
10. [obra/superpowers Issue #429](https://github.com/obra/superpowers/issues/429) - **Credibility: Medium** - Community discussion of TeammateTool integration
11. [claudefa.st - Agent Teams Guide](https://claudefa.st/blog/guide/agents/agent-teams) - **Credibility: Medium** - Community documentation site
12. [Heise Online - Anthropic Agent Teams](https://www.heise.de/en/news/Anthropic-introduces-Claude-Opus-4-6-with-Agent-Teams-11167248.html) - **Credibility: High** - Established tech news outlet

## Related Topics

- Claude Code subagents vs agent teams comparison
- Git worktree workflows for manual parallel sessions
- Claude Code hooks system (TeammateIdle, TaskCompleted)
- Claude Code SDK programmatic team control
- Token cost optimization for multi-agent workflows
- tmux configuration for split-pane agent teams
