---
type: claude-knowledge
source: aiprojects
source_path: ".claude/agent-output/results/deep-research/2026-02-08_claude-code-persistent-memory.md"
source_category: "deep-research"
synced: 2026-02-17
title: "Deep Research: Claude Code Persistent Memory (v2.1.33)"
tags:
  - claude-knowledge
  - deep-research
---

# Deep Research: Claude Code Persistent Memory (v2.1.33)

**Research Date**: 2026-02-08
**Confidence Level**: High
**Sources Consulted**: 12+

## Executive Summary

Claude Code v2.1.33 (released February 6, 2026) consolidates and enhances a multi-layered persistent memory system that enables automatic cross-session context retention. The system comprises three distinct but complementary layers: (1) **Auto Memory** -- an automatic system where Claude writes notes to itself in a per-project `MEMORY.md` file and topic sub-files; (2) **CLAUDE.md** -- user-authored instruction/preference files in a hierarchy of scopes; and (3) **Agent Memory** (new in v2.1.33) -- a frontmatter-based persistent memory system for subagents with `user`, `project`, or `local` scope. This is entirely separate from any Memory MCP server (knowledge graph); the built-in system uses plain Markdown files on disk, not a graph database.

The key v2.1.33 additions are the `memory` frontmatter field for agent definitions, the "Recalled/Wrote memories" terminal UX, and automatic memory recording without user intervention.

## Key Findings

### 1. What Persistent Memory Is

Claude Code's built-in persistent memory is a **file-based system** that stores information as Markdown files on disk. It has three layers:

| Layer | Who Writes | Storage | Loaded At Startup |
|-------|-----------|---------|-------------------|
| **Auto Memory** | Claude (automatic) | `~/.claude/projects/<project>/memory/MEMORY.md` + topic files | First 200 lines of MEMORY.md |
| **CLAUDE.md** | User (manual) | Hierarchical: managed policy, project, rules, user, local | Full content (hierarchy-dependent) |
| **Agent Memory** | Subagents (automatic) | Scope-dependent (see below) | First 200 lines of agent's MEMORY.md |

**Auto Memory** is the primary "persistent memory" feature. Claude automatically:
- Records project patterns (build commands, test conventions, code style)
- Saves debugging insights (solutions, common error causes)
- Notes architecture details (key files, module relationships, abstractions)
- Remembers user preferences (communication style, workflow habits, tool choices)

The directory structure per project:

```
~/.claude/projects/<project>/memory/
  MEMORY.md          # Concise index, loaded into every session (first 200 lines)
  debugging.md       # Detailed notes on debugging patterns
  api-conventions.md # API design decisions
  ...                # Any other topic files Claude creates
```

The `<project>` path is derived from the git repository root. All subdirectories within the same repo share one auto memory directory. Git worktrees get separate directories. Outside a git repo, the working directory is used.

### 2. How to Enable/Configure

**Auto Memory is opt-in during the gradual rollout.** Control via environment variable:

```bash
# Force ON (opt-in during gradual rollout)
export CLAUDE_CODE_DISABLE_AUTO_MEMORY=0

# Force OFF
export CLAUDE_CODE_DISABLE_AUTO_MEMORY=1

# Unset = follows gradual rollout (may or may not be active)
```

Note the double-negative logic: `DISABLE=0` means "don't disable" = enabled.

**No settings.json key** exists for auto memory. The only related settings.json option is `cleanupPeriodDays` (default: 30) which controls how long session transcripts are retained.

**For Agent Memory** (subagents), enable via the `memory` frontmatter field in the agent definition:

```yaml
---
name: code-reviewer
description: Reviews code for quality and best practices
memory: user    # Options: user, project, local
---
```

Agent memory scope locations:

| Scope | Location | Use When |
|-------|----------|----------|
| `user` | `~/.claude/agent-memory/<agent-name>/` | Agent should remember across all projects |
| `project` | `.claude/agent-memory/<agent-name>/` | Knowledge is project-specific, shareable via VCS |
| `local` | `.claude/agent-memory-local/<agent-name>/` | Project-specific but not version-controlled |

### 3. What Gets Persisted

**Auto Memory (Claude writes automatically):**
- Project patterns: build commands, test conventions, code style preferences
- Debugging insights: solutions to tricky problems, common error causes
- Architecture notes: key files, module relationships, important abstractions
- User preferences: communication style, workflow habits, tool choices
- Index of topic files in MEMORY.md

**CLAUDE.md (User writes manually):**
- Project instructions, coding standards, workflow rules
- Tool preferences, naming conventions
- Architecture documentation, API standards
- Personal preferences (in CLAUDE.local.md or ~/.claude/CLAUDE.md)

**Agent Memory (Subagents write automatically):**
- Codebase patterns, library locations, architectural decisions
- Debugging codepaths, recurring issues
- Whatever the agent's system prompt instructs it to record

**Session Transcripts (automatic, JSONL):**
- Full conversation history stored as `~/.claude/projects/<project-path>/{session-id}.jsonl`
- Retained for `cleanupPeriodDays` (default 30 days)
- NOT loaded into context at startup (separate from memory)

### 4. Cross-Session Behavior

**Yes, memory carries over automatically.** The flow is:

1. **Session Start**: Claude loads the first 200 lines of `MEMORY.md` into its system prompt. The terminal shows `Recalled X memories (ctrl+o to expand)`.
2. **During Session**: Claude reads and writes to memory files as it works. It may create topic files for detailed notes. The terminal shows `Wrote X memories (ctrl+o to expand)` periodically.
3. **Session End**: Memory files persist on disk.
4. **Next Session**: Step 1 repeats. Claude has access to everything it previously wrote.

**Important loading details:**
- Only the first 200 lines of MEMORY.md load at startup
- Topic files (debugging.md, patterns.md, etc.) are NOT loaded at startup -- Claude reads them on-demand when needed
- Claude is instructed to keep MEMORY.md concise by moving detailed notes into topic files
- CLAUDE.md files in the directory hierarchy above the working directory load in full at launch
- CLAUDE.md files in child directories load on demand when Claude reads files in those subdirectories

**Session resume** (`--resume`) is separate from memory. It restores the full conversation history of a specific session. Memory provides cross-session context without restoring full transcripts.

### 5. Interaction with Memory MCP Server

**Built-in auto memory and Memory MCP servers are completely independent systems.** They can coexist without conflict.

| Aspect | Built-in Auto Memory | Memory MCP Server |
|--------|---------------------|-------------------|
| **Storage** | Markdown files on disk | Knowledge graph (typically Neo4j or SQLite) |
| **Structure** | Flat files with index | Entities, relations, observations |
| **Loaded at startup** | First 200 lines of MEMORY.md | Only if explicitly queried via MCP tools |
| **Query method** | Claude reads files with standard tools | MCP tools (memory_search, memory_related, memory_ask) |
| **Scope** | Per-project directory | Configurable (per-database) |
| **Writes** | Claude writes Markdown files | Claude calls MCP create_entities, add_observations |
| **Searchability** | File-based (grep/read) | Semantic search, relationship traversal |
| **Shared with team** | Only if files committed to VCS | Only if database shared |

**Practical coexistence strategy:**
- Use **built-in auto memory** for: quick project context, build patterns, architecture overview, preferences (lightweight, automatic, zero-config)
- Use **Memory MCP** for: rich knowledge graphs, cross-project relationships, semantic search, structured entity/relation data, complex decision tracking

They do NOT interfere with each other. Auto memory writes to `~/.claude/projects/<project>/memory/` while MCP memory writes to its configured database. Claude can use both simultaneously.

### 6. CLI Flags and Settings

**Environment Variables:**

| Variable | Purpose |
|----------|---------|
| `CLAUDE_CODE_DISABLE_AUTO_MEMORY=0` | Force auto memory ON |
| `CLAUDE_CODE_DISABLE_AUTO_MEMORY=1` | Force auto memory OFF |
| `CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD=1` | Load CLAUDE.md from `--add-dir` directories |
| `CLAUDE_CONFIG_DIR` | Override config/data directory |

**settings.json:**

| Key | Purpose | Default |
|-----|---------|---------|
| `cleanupPeriodDays` | Session transcript retention | 30 |

**CLI Flags:**

| Flag | Purpose |
|------|---------|
| `--add-dir` | Add directories for Claude to access (CLAUDE.md not loaded unless env var set) |
| `--agents` | Pass agent definitions as JSON (supports `memory` field) |
| `--resume` | Resume a specific session (separate from memory) |

**Slash Commands:**

| Command | Purpose |
|---------|---------|
| `/memory` | Open file selector showing all memory files (CLAUDE.md, auto memory, etc.) |
| `/init` | Bootstrap a CLAUDE.md for your project |

**CLAUDE.md Import Syntax:**
```
@path/to/file.md    # Import file content into CLAUDE.md
@~/shared-rules.md  # Absolute path import
```

## Detailed Analysis

### Version Timeline

| Version | Date | Memory Changes |
|---------|------|---------------|
| ~v2.0.64 | Late 2025 | Underlying session memory system introduced |
| v2.1.30 | Early Feb 2026 | "Recalled/Wrote memories" terminal messages appear; reduced --resume memory usage by 68% |
| v2.1.31 | Early Feb 2026 | Session resume hints added on exit |
| v2.1.32 | Feb 2026 | Agent teams preview; "Claude now automatically records and recalls memories" |
| **v2.1.33** | **Feb 6, 2026** | **`memory` frontmatter field for agents; persistent memory with user/project/local scope** |

### Auto Memory Architecture

The auto memory system works through standard file tools:
1. Claude's system prompt includes the first 200 lines of `MEMORY.md` plus instructions for managing the memory directory
2. Claude uses Read, Write, and Edit tools to maintain memory files
3. No special memory API or tool -- it's file-based
4. The `/memory` command opens files in the system editor

This means auto memory content is:
- Fully transparent (you can read/edit the files directly)
- Backed up naturally by filesystem backups
- Portable if you copy `~/.claude/projects/` to another machine
- Not encrypted or protected (plain Markdown)

### Agent Memory Architecture

New in v2.1.33, the `memory` frontmatter field creates a dedicated memory directory for each agent:

```yaml
---
name: my-agent
description: Does things
memory: user  # user | project | local
---

You are an agent. Update your agent memory as you discover patterns...
```

When `memory` is enabled on an agent:
- The agent's system prompt includes instructions for reading/writing to its memory directory
- First 200 lines of the agent's `MEMORY.md` are injected into its context
- Read, Write, and Edit tools are automatically enabled for the agent
- The agent curates MEMORY.md if it exceeds 200 lines (moving details to topic files)

### Modular Rules (.claude/rules/)

A complementary feature for project-specific instructions:

```
.claude/rules/
  code-style.md     # Always loaded
  testing.md         # Always loaded
  frontend/
    react.md         # Always loaded (recursive)
  api-rules.md       # Conditional (with paths: frontmatter)
```

Path-specific rules use YAML frontmatter:
```yaml
---
paths:
  - "src/api/**/*.ts"
---
# API Development Rules
...
```

User-level rules in `~/.claude/rules/` apply to all projects (lower priority than project rules).

## Best Practices

1. **Enable auto memory immediately**: Add `export CLAUDE_CODE_DISABLE_AUTO_MEMORY=0` to your shell profile if you're not in the rollout yet.

2. **Keep MEMORY.md under 200 lines**: Content beyond 200 lines is not loaded at startup. Move details into topic files.

3. **Use the right memory layer**:
   - Auto memory: Let Claude handle it automatically for project context
   - CLAUDE.md: Write explicit instructions, rules, and preferences
   - Agent memory: For specialized agents that build domain knowledge
   - Memory MCP: For structured knowledge graphs with semantic search

4. **Review auto memory periodically**: Run `/memory` to see and edit what Claude has written. Remove outdated or incorrect entries.

5. **Instruct agents to use memory**: Include prompts like "Update your agent memory as you discover patterns" in agent system prompts.

6. **Separate concerns**: Use `CLAUDE.local.md` for personal preferences (auto-gitignored), project `CLAUDE.md` for team standards.

7. **Don't fight auto memory**: It complements your CLAUDE.md files. Auto memory captures what Claude discovers; CLAUDE.md contains your explicit instructions.

## Common Pitfalls

1. **Exceeding 200 lines in MEMORY.md**: Content beyond line 200 is silently ignored at startup. Monitor file size.

2. **Confusing auto memory with session resume**: `--resume` restores a full conversation. Auto memory provides cross-session context without full transcript restoration.

3. **Assuming Memory MCP replaces auto memory**: They serve different purposes and coexist independently.

4. **Not setting the environment variable**: During gradual rollout, auto memory may not be active unless you explicitly set `CLAUDE_CODE_DISABLE_AUTO_MEMORY=0`.

5. **Expecting topic files to load at startup**: Only `MEMORY.md` loads automatically. Topic files are read on-demand.

6. **Agent memory without instructions**: If you add `memory: user` to an agent but don't instruct it to use memory, it may not proactively write to it.

## Conflicting Information

- **Session Memory vs Auto Memory terminology**: Some community sources use "Session Memory" to describe a separate system from "Auto Memory". The official docs primarily use "Auto Memory" for the MEMORY.md-based system. The "Recalled/Wrote memories" terminal messages appear to be the UX layer for auto memory, not a separate system.

- **v2.1.32 vs v2.1.33 for auto memory**: Some sources attribute automatic memory recording to v2.1.32, others to v2.1.33. The changelog suggests the automatic recording was in v2.1.32 and the agent-level `memory` frontmatter field was added in v2.1.33.

- **Third-party vs built-in**: Many community articles discuss third-party memory solutions (claude-mem, mem0, Memory MCP) as "persistent memory for Claude Code". The built-in auto memory system is distinct from all of these.

## Knowledge Gaps

1. **Exact rollout percentage**: It's unclear what percentage of users have auto memory enabled by default (without the env var).

2. **Memory compaction**: No documentation found on whether MEMORY.md is automatically compacted or if Claude has instructions to prune old entries.

3. **Multi-machine sync**: No built-in mechanism for syncing `~/.claude/projects/` memory across machines.

4. **Memory encryption**: No mention of encryption for auto memory files. They appear to be plain Markdown.

5. **Token budget**: The exact token budget consumed by the 200 lines of MEMORY.md is not documented.

6. **Interaction when both auto memory and Memory MCP are active**: No official guidance on priority or deduplication between the two systems.

## Recommendations

### For Your AIProjects Setup

1. **Enable auto memory now**:
   ```bash
   # Add to ~/.bashrc or ~/.zshrc
   export CLAUDE_CODE_DISABLE_AUTO_MEMORY=0
   ```

2. **Add `memory` field to your custom agents**: Update agent definitions in `.claude/agents/` to include `memory: user` or `memory: project` as appropriate. For example, your `deep-research` agent would benefit from `memory: user` to accumulate research strategies across sessions.

3. **Keep your Memory MCP server**: It provides structured knowledge graph capabilities that auto memory does not. Use auto memory for lightweight per-project context and Memory MCP for cross-project semantic search and relationship tracking.

4. **Review auto memory content**: Check `~/.claude/projects/$(pwd | sed 's|/|-|g')/memory/MEMORY.md` to see what Claude has been recording.

5. **Update session-state.md references**: Your session management workflow can be simplified since auto memory now handles some of what session-state.md tracked manually.

6. **Add agent memory instructions**: Update your agent system prompts to proactively use memory:
   ```
   Update your agent memory as you discover patterns, effective research
   strategies, and valuable source types. This builds institutional
   knowledge across conversations.
   ```

## Sources

1. [Manage Claude's memory - Official Claude Code Docs](https://code.claude.com/docs/en/memory) - **Credibility: High** (primary official documentation)
2. [Create custom subagents - Official Claude Code Docs](https://code.claude.com/docs/en/sub-agents) - **Credibility: High** (official agent memory documentation)
3. [Claude Code Settings - Official Docs](https://code.claude.com/docs/en/settings) - **Credibility: High** (environment variables, settings.json)
4. [Claude Code CHANGELOG.md - GitHub](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md) - **Credibility: High** (version history)
5. [Claude Code Releases - GitHub](https://github.com/anthropics/claude-code/releases) - **Credibility: High** (release notes)
6. [Claude Code Session Memory - claudefa.st](https://claudefa.st/blog/guide/mechanics/session-memory) - **Credibility: Medium** (community guide, detailed technical info)
7. [The Architecture of Persistent Memory for Claude Code - DEV Community](https://dev.to/suede/the-architecture-of-persistent-memory-for-claude-code-17d) - **Credibility: Medium** (technical analysis)
8. [How Claude's memory and MCP work - Mintlify](https://www.mintlify.com/blog/how-claudes-memory-and-mcp-work) - **Credibility: Medium** (comparison article)
9. [Claude Code v2.1.33 Release Notes - ClaudeWorld](https://claude-world.com/articles/claude-code-2133-release/) - **Credibility: Medium** (third-party release coverage)
10. [Claude Code by Anthropic - Releasebot](https://releasebot.io/updates/anthropic/claude-code) - **Credibility: Medium** (automated release tracking)
11. [How Claude Code Manages Local Storage - Milvus Blog](https://milvus.io/blog/why-claude-code-feels-so-stable-a-developers-deep-dive-into-its-local-storage-design.md) - **Credibility: Medium** (technical deep dive)
12. [Session cleanup issue #18881 - GitHub](https://github.com/anthropics/claude-code/issues/18881) - **Credibility: High** (official issue tracker)

## Related Topics

- Claude Code Agent Teams (v2.1.32+) -- multi-agent collaboration with shared memory
- Claude Code Skills system -- how skills interact with memory loading
- Claude Code Plugins -- distributing agents with memory configurations
- CLAUDE.md optimization -- strategies for keeping CLAUDE.md effective as projects grow
- Memory MCP alternatives -- Mem0, claude-mem, mcp-memory-service comparison
