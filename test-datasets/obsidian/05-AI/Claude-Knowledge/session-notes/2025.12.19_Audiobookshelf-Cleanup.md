---
type: claude-knowledge
source: aiprojects
source_path: "knowledge/notes/session-20251219-audiobookshelf-cleanup.md"
source_category: "session-knowledge"
synced: 2026-02-17
title: "AudiobookShelf Library Cleanup Session"
tags:
  - claude-knowledge
  - session-knowledge
---

# AudiobookShelf Library Cleanup Session

**Date:** 2025-12-19
**Duration:** Extended session (continued from previous context)
**Scope:** Complete audiobook library metadata cleanup and series organization

## Summary

Comprehensive cleanup of AudiobookShelf library at `audiobooks.theklyx.space`, fixing split audiobooks, series metadata, and sequence numbering.

## API Details

- **URL:** https://audiobooks.theklyx.space/api
- **Library ID:** ecd44e48-b455-4183-97c4-100396e99186
- **Auth:** Bearer token (stored in scripts)

## Work Completed

### Phase 1: Split Audiobook Merge

**Problem:** Many audiobooks were split into multiple entries (Part 1, Part 2, Disk 1-7, etc.)

**Solution:** Created Python scripts to merge audio files from subfolders into parent folders.

| Book | Parts Merged | Files Moved |
|------|--------------|-------------|
| Stormlight Archive (4 books) | ~20 parts each | 200+ files |
| Mistborn Era 1 & 2 | Multiple parts | 100+ files |
| Elantris | 3 parts | 50+ files |
| Good to Great | 7 disks | 151 files |
| Robot Geneticists | Nested structure | Various |

**Scripts Created:**
- `/tmp/merge_audiobooks_v2.py` - Main merge script
- `/tmp/delete_orphaned_entries.py` - Cleanup orphaned DB entries

**Total:** 361+ files merged, 38 orphaned entries deleted

### Phase 2: Title Fixes and Audible Matching

**Fixed 22 titles:**
- 4 Wheel of Time books (removed "XX - " prefix)
- 5 Dune books (fixed "New Chronicles" misnaming)
- 13 other malformed titles

**Audible Match Results:**
- Started with 206 unmatched books
- After fixes: 159 matched successfully
- Final library: 93.5% matched (716/766 books)

### Phase 3: Series Metadata Cleanup

#### Task 1: Remove Single-Book Series Tags (62 removed)
Books incorrectly tagged as their own series:
- Ender's Game, Foundation, Dune, Warbreaker
- Various "Book X" artifacts from folder names
- Standalone books with unnecessary series tags

#### Task 2: Add Sequence Numbers (56 books)
Series with no numbering fixed:
- **Harry Potter** (7 books) - Numbered 1-7
- **Vorkosigan Saga** (15 books) - Numbered 1-15 (chronological order)

#### Task 3: Fix Partially Numbered Series (34 books)
- **Murderbot Diaries** - 1-6
- **Heartstrikers** - 1-5
- **Detroit Free Zone** - 1-3
- **The Reckoners** - 1-4 (including 1.5 for Mitosis)
- **Shadow Children** - 1-7
- **World of the Five Gods** - 1-7
- **Elantris** - 1-2
- **Mistborn Era 2** - 1-4 (with 1.5, 3.5 for novellas)
- **Spellmonger** - Added #1 for Golden Goblin

#### Task 4: Clean Up Artifact Series (8 books)
Removed from fake "series":
- "Short Fiction" (3 books) - Removed series tag
- "Non-Series" (5 books) - Removed series tag

Empty artifact series flagged for cleanup:
- "Good to Great", "Robto Geneticists", "2005 - Elantris", "Book 3 - 2016 - The Bands of Mourning"

### Phase 4: Missing Books Report

Generated comprehensive report saved to `/tmp/missing_books_report.md`

| Series | Have | Total | Missing |
|--------|------|-------|---------|
| The Expanse | 3 | 9 | Books 1-6 |
| First Law World | 3 | 10 | Original trilogy + standalones |
| Bobiverse | 4 | 5 | Not Till We Are Lost |
| Murderbot Diaries | 6 | 7 | System Collapse |
| He Who Fights with Monsters | 11 | 12 | Book 12 |
| Vorkosigan saga | 15 | 17 | Mirror Dance, Komarr, Diplomatic Immunity |
| Discworld | 39 | 41 | #13, #37 (have separately), #39 |
| Galaxy's Edge | 13 | 17 | #1-2, #6, #8 |
| Top 100 Sci-Fi | 92 | 100 | #11, #13, #88, #89, #92, #94, #95, #100 |

## Final Library Stats

| Metric | Before | After |
|--------|--------|-------|
| Total Books | 803 | 766 |
| Matched (Audible) | ~73% | 93.5% |
| Missing Entries | 29+ | 0 |
| Series with Issues | 96 | ~10 |

## Scripts Reference

All scripts stored in `/tmp/` (ephemeral):
- `analyze_library.py` - Initial analysis
- `analyze_unmatched.py` - Unmatched categorization
- `fix_titles_and_match.py` - Title fixes + Audible matching
- `analyze_merge_targets.py` - Merge target analysis
- `merge_audiobooks_v2.py` - File merger
- `delete_orphaned_entries.py` - DB cleanup
- `missing_books_report.md` - Missing books report

## API Patterns Used

```python
# Get all items
GET /api/libraries/{library_id}/items?limit=1000

# Get all series
GET /api/libraries/{library_id}/series?limit=500

# Update item metadata (series, title, etc.)
PATCH /api/items/{item_id}/media
Body: {"metadata": {"series": [...], "title": "..."}}

# Delete item
DELETE /api/items/{item_id}

# Trigger library scan
POST /api/libraries/{library_id}/scan

# Match with Audible
POST /api/items/{item_id}/match
Body: {"provider": "audible"}
```

## Lessons Learned

1. AudiobookShelf creates series from folder names - keep folder structure clean
2. Split audiobooks should be merged at filesystem level, then orphaned DB entries deleted
3. Series endpoint provides full book details; items endpoint has minimal series info
4. Empty series don't auto-delete but should clean up on next scan
5. Sequence numbers stored in series array on each item, not on series itself

## Follow-up Tasks

- [ ] Acquire missing Expanse books (1-6)
- [ ] Get Murderbot #7 (System Collapse)
- [ ] Consider First Law World completion
- [ ] Verify Discworld #13, #37 are properly in main series
- [ ] Check if empty artifact series cleaned up after scan
