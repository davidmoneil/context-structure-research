---
type: claude-knowledge
source: aiprojects
source_path: "knowledge/notes/session-20251211-n8n-onetrust-plugin.md"
source_category: "session-knowledge"
synced: 2026-02-17
title: "Session Notes: n8n OneTrust Plugin Development"
tags:
  - claude-knowledge
  - session-knowledge
---

# Session Notes: n8n OneTrust Plugin Development

**Date**: 2025-12-11
**Status**: Work in Progress (Blocked on credentials)
**Duration**: ~1 hour

## Objective

Build a custom n8n community node to integrate with OneTrust Risk Management API for automating risk workflows, task management, and control implementation reviews.

## What We Built

### Project Structure

Created complete n8n community node at `~/Code/n8n-nodes-onetrust/`:

```
n8n-nodes-onetrust/
├── credentials/
│   └── OneTrustOAuth2Api.credentials.ts  # Dual auth: API Key + OAuth2
├── nodes/
│   └── OneTrust/
│       ├── OneTrust.node.ts              # Declarative style node
│       ├── OneTrust.node.json            # Codex metadata
│       └── onetrust.svg                  # Icon
├── icons/
│   └── onetrust.svg
├── dist/                                  # Built output
├── package.json                           # pnpm, Node 22+
├── tsconfig.json
├── gulpfile.js
└── README.md
```

### Node Capabilities (Phase 1 - Read Only)

| Resource | Operation | Description |
|----------|-----------|-------------|
| **Risk** | Get | Get single risk by ID |
| **Risk** | Get Many | List risks with filters |
| **Task** | Get | Get single task by ID |
| **Task** | Get Many | Get tasks for an object |
| **Control Implementation** | Get Many | Get controls by entity |

### Authentication

Supports two methods:
1. **API Key** (recommended) - Long-lived token from OneTrust
2. **OAuth2 Client Credentials** - Client ID/Secret with token refresh

### Docker Integration

Updated `/home/davidmoneil/Docker/mydocker/n8n/docker-compose.yml`:
- Added volume mount: `~/Code/n8n-nodes-onetrust:/home/node/.n8n/custom/n8n-nodes-onetrust:ro`
- Updated `N8N_CUSTOM_EXTENSIONS` to point to custom node path

## Blocker: OneTrust Credentials

### The Problem

User cannot find the "Client Credentials" menu in OneTrust to create API access credentials.

### What We Found

- **Integrations → Create Credentials**: For outbound connections (OneTrust calling external APIs) - NOT what we need
- **Access Management → ???**: Client Credentials option not visible

### Expected Location

According to OneTrust documentation:
```
Global Settings (gear icon)
  └── Access Management
        └── Client Credentials
              ├── Client Credentials tab (OAuth2)
              └── API Keys tab
```

### Possible Causes

1. **Permission Issue**: User may need "Admin" or "Manage Client Credentials" role
2. **License Tier**: API access may not be included in subscription
3. **Different Menu Location**: Some OneTrust versions organize settings differently

### Resolution Path

User needs to:
1. Check with OneTrust admin about permissions
2. Or explore other menu locations in Global Settings
3. Or request admin to create credentials on their behalf

## Technical Decisions

### Why Declarative Style?

- Recommended by n8n for REST API integrations
- Less boilerplate code
- Automatic request handling
- Easier maintenance

### Why Both Auth Methods?

- **API Key**: Simpler for quick setup, long-lived
- **OAuth2**: Enterprise standard, more secure, auto-refresh

### Why Phase 1 Read-Only?

- Production environment - must be safe
- Validate integration works before enabling writes
- Can add write operations in Phase 2 after testing

## Next Steps (When Resuming)

1. **User obtains credentials** from OneTrust (API Key preferred)
2. **Restart n8n**: `docker restart n8n`
3. **Verify node loads**: Check n8n UI for "OneTrust" node
4. **Configure credentials**: In n8n, create OneTrust credential
5. **Create test risk**: In OneTrust, create a risk for testing
6. **Test operations**: Get Risk, Get Many Risks

## Development Workflow (For Future Changes)

```bash
cd ~/Code/n8n-nodes-onetrust
# Make code changes
pnpm build
docker restart n8n
# Test in n8n UI
```

## References

- [n8n-nodes-starter](https://github.com/n8n-io/n8n-nodes-starter)
- [OneTrust API Reference](https://developer.onetrust.com/onetrust/reference/onetrust-api-reference)
- [OneTrust OAuth Scopes](https://developer.onetrust.com/onetrust/reference/oauth-20-scopes)
- [Managing OAuth 2.0 API Keys](https://my.onetrust.com/articles/en_US/Knowledge/UUID-76f55697-ba16-d000-849a-d33e3d217f41)

## Files Modified Outside Project

- `/home/davidmoneil/Docker/mydocker/n8n/docker-compose.yml` - Added custom node mount
