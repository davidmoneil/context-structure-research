---
type: claude-knowledge
source: aiprojects
source_path: "knowledge/notes/session-20251114-arr-stack-setup.md"
source_category: "session-knowledge"
synced: 2026-02-17
title: "Session: Sonarr/Radarr Media Automation Setup"
tags:
  - claude-knowledge
  - session-knowledge
---

# Session: Sonarr/Radarr Media Automation Setup

**Date**: 2025-11-14
**Session**: Sonarr Radarr Setup
**Status**: In Progress - Deployment Blocked
**Duration**: ~2 hours

## Session Overview

Setting up automated media management infrastructure (Sonarr, Radarr, Prowlarr) to handle TV shows and movies downloaded via qBittorrent.

## Completed Tasks âœ…

### 1. Infrastructure Planning & Discovery
- **Explained *arr stack architecture**: Sonarr (TV), Radarr (Movies), Prowlarr (Indexer management)
- **Gathered requirements**:
  - qBittorrent running at `192.168.1.130:8080`
  - Downloads location: `192.168.1.96:/volume1/downloads` (NAS)
  - Media library: `192.168.1.96:/volume1/Media`
  - User wants selective file import (video only, not .txt/.nfo/.png)

### 2. NAS Mount Configuration
- **Mounted downloads share via NFS with persistence**:
  ```bash
  192.168.1.96:/volume1/downloads â†’ /mnt/synology_nas/downloads
  ```
- **Updated `/etc/fstab`** for persistent mount on reboot
- **Verified folder structure**:
  - `/mnt/synology_nas/downloads/complete/` (empty, ready for qBittorrent)
  - `/mnt/synology_nas/downloads/incomplete/` (in-progress downloads)
  - `/mnt/synology_nas/Media/Movies/` (final movie destination)
  - `/mnt/synology_nas/Media/TV Shows/` (final TV destination)

### 3. Docker Compose Stack Creation
- **Created directory structure**: `/home/davidmoneil/Docker/mydocker/arr-stack/`
  - `sonarr/` - Config directory
  - `radarr/` - Config directory
  - `prowlarr/` - Config directory
- **Created `docker-compose.yml`** with:
  - **Prowlarr** (port 9696): Indexer manager
  - **Sonarr** (port 8989): TV show automation
  - **Radarr** (port 7878): Movie automation
  - Proper volume mounts for NAS paths
  - Watchtower labels for auto-updates
  - Caddy network integration
- **Created comprehensive `README.md`** with:
  - Setup workflow documentation
  - Configuration steps for each service
  - File flow diagram
  - Troubleshooting guide

### 4. Docker Context Fix
- **Issue identified**: Docker Desktop context (`desktop-linux`) blocking NAS path mounts
- **Solution applied**: Switched to `default` Docker context
  ```bash
  docker context use default
  ```
- This resolved "mounts denied" error for `/mnt/synology_nas/*` paths

## Current Blocker ğŸš§

### Deployment Failing - Image Pull Issues
**Status**: Docker image pulls are failing/timing out
**Error**: Exit code 1 during `docker compose up -d`
**Images needed**:
- `lscr.io/linuxserver/prowlarr:latest`
- `lscr.io/linuxserver/sonarr:latest`
- `lscr.io/linuxserver/radarr:latest`

**Possible causes**:
1. Network connectivity to lscr.io (LinuxServer.io registry)
2. Docker Hub rate limiting
3. Firewall/DNS issues

**Next steps to resolve**:
- Check network connectivity: `ping lscr.io`
- Test direct pull: `docker pull lscr.io/linuxserver/sonarr:latest`
- Check Docker daemon logs: `journalctl -u docker -n 50`
- Alternative: Use Docker Hub mirrors or different registry

## Pending Tasks ğŸ“‹

### Phase 1: Complete Deployment
1. **Resolve image pull issues** and successfully deploy containers
2. **Verify containers are running**: `docker ps | grep -E "sonarr|radarr|prowlarr"`
3. **Check health status** and logs

### Phase 2: Service Configuration
4. **Configure Prowlarr** (http://localhost:9696):
   - Add torrent/usenet indexers
   - Get API key
   - Connect to Sonarr and Radarr as apps

5. **Configure Sonarr** (http://localhost:8989):
   - Set media management (rename episodes, naming format)
   - Add download client: qBittorrent at `192.168.1.130:8080`
   - Set category: `tv`
   - Add Prowlarr connection
   - Test with a TV show

6. **Configure Radarr** (http://localhost:7878):
   - Set media management (rename movies, naming format)
   - Add download client: qBittorrent at `192.168.1.130:8080`
   - Set category: `movies`
   - Add Prowlarr connection
   - Test with a movie

7. **Configure qBittorrent categories**:
   - Category `tv` â†’ Save to `/downloads/complete/tv/`
   - Category `movies` â†’ Save to `/downloads/complete/movies/`

### Phase 3: Automation & Integration
8. **Test automated workflow**:
   - Add a TV show to Sonarr
   - Verify download starts in qBittorrent
   - Verify import to `/mnt/synology_nas/Media/TV Shows/`
   - Confirm only video files imported (not .nfo, .txt, etc.)

9. **Add Caddy reverse proxy** for HTTPS access:
   - `sonarr.theklyx.space â†’ sonarr:8989`
   - `radarr.theklyx.space â†’ radarr:7878`
   - `prowlarr.theklyx.space â†’ prowlarr:9696`
   - Add OAuth2 authentication

10. **Create cleanup script**:
    - Script to remove leftover files in `/mnt/synology_nas/downloads/complete/`
    - Remove .txt, .nfo, .png, .jpg, sample files
    - Schedule via cron (weekly cleanup)

### Phase 4: Documentation
11. **Update paths-registry.yaml**:
    - Add arr-stack services
    - Document new downloads mount
    - Add service URLs and ports

12. **Create context documentation**:
    - `.claude/context/systems/docker/arr-stack.md`
    - Document qBittorrent integration
    - Document file flow and automation

13. **Optional: Plex integration**:
    - Configure Sonarr/Radarr to notify Plex of new content
    - Automatic library scans

## Architecture Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Actions                             â”‚
â”‚  (Add TV show to Sonarr / Add movie to Radarr)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prowlarr (Indexer Manager)                                â”‚
â”‚  - Searches configured torrent/usenet sites                â”‚
â”‚  - Returns best match to Sonarr/Radarr                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  qBittorrent (192.168.1.130:8080)                          â”‚
â”‚  - Downloads to: /volume1/downloads/incomplete/            â”‚
â”‚  - Moves to: /volume1/downloads/complete/tv/ or /movies/   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sonarr/Radarr (Monitor for completion)                    â”‚
â”‚  - Detect download finished                                â”‚
â”‚  - Import ONLY video files (.mkv, .mp4, .avi)             â”‚
â”‚  - Ignore: .txt, .nfo, .png, .jpg, .torrent               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Media Library (NAS)                                        â”‚
â”‚  /volume1/Media/TV Shows/ - Organized TV episodes          â”‚
â”‚  /volume1/Media/Movies/   - Organized movies               â”‚
â”‚  - Renamed with proper format                              â”‚
â”‚  - Ready for Plex                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Paths Reference

| Purpose | Container Path | Host Path | NAS Path |
|---------|---------------|-----------|----------|
| TV Library | `/tv` | `/mnt/synology_nas/Media/TV Shows` | `192.168.1.96:/volume1/Media/TV Shows` |
| Movie Library | `/movies` | `/mnt/synology_nas/Media/Movies` | `192.168.1.96:/volume1/Media/Movies` |
| Downloads | `/downloads` | `/mnt/synology_nas/downloads` | `192.168.1.96:/volume1/downloads` |
| Sonarr Config | `/config` | `/home/davidmoneil/Docker/mydocker/arr-stack/sonarr` | Local |
| Radarr Config | `/config` | `/home/davidmoneil/Docker/mydocker/arr-stack/radarr` | Local |
| Prowlarr Config | `/config` | `/home/davidmoneil/Docker/mydocker/arr-stack/prowlarr` | Local |

## Technical Notes

### Docker Context Switch
- **Before**: `desktop-linux` context (Docker Desktop VM) - blocked NAS mounts
- **After**: `default` context (native Docker) - allows all host paths
- **Persist change**: Context remains across reboots

### NFS Mount Details
```bash
# Mount command used:
sudo mount -t nfs -o defaults,auto,nofail,noatime,intr \
  192.168.1.96:/volume1/downloads /mnt/synology_nas/downloads

# fstab entry:
192.168.1.96:/volume1/downloads /mnt/synology_nas/downloads nfs defaults,auto,nofail,noatime,intr 0 0
```

### qBittorrent Integration Requirements
**Critical**: Paths in qBittorrent and Sonarr/Radarr must match EXACTLY for hardlinking to work:
- qBittorrent sees: `/downloads/complete/tv/` (via SMB/NFS on host 192.168.1.130)
- Sonarr container sees: `/downloads/complete/tv/` (via Docker volume mount)
- If paths don't match, files will be COPIED instead of moved (wastes space)

### Watchtower Auto-Updates
All services labeled for automatic updates:
- Scope: `prod` (every 4 hours)
- Ensures latest security patches and features

## Next Session Priorities

1. **Immediate**: Resolve Docker image pull issue
2. **Configure**: Prowlarr â†’ Sonarr â†’ Radarr chain
3. **Test**: End-to-end workflow with one TV show
4. **Verify**: Only video files imported, junk files left behind
5. **Expose**: Add to Caddy for HTTPS access

## Files Created This Session

- `/home/davidmoneil/Docker/mydocker/arr-stack/docker-compose.yml`
- `/home/davidmoneil/Docker/mydocker/arr-stack/README.md`
- `/home/davidmoneil/Docker/mydocker/arr-stack/sonarr/` (directory)
- `/home/davidmoneil/Docker/mydocker/arr-stack/radarr/` (directory)
- `/home/davidmoneil/Docker/mydocker/arr-stack/prowlarr/` (directory)
- `/etc/fstab` (appended NFS mount)
- `/home/davidmoneil/AIProjects/knowledge/notes/session-20251114-arr-stack-setup.md` (this file)

## Related Documentation

- Main README: `/home/davidmoneil/Docker/mydocker/arr-stack/README.md`
- Paths Registry: `/home/davidmoneil/AIProjects/paths-registry.yaml` (to be updated)
- Session State: `/home/davidmoneil/AIProjects/.claude/context/session-state.md` (to be updated)

---

**Session End**: Pending deployment resolution
**Next Session**: Resume from "Resolve image pull issues"
